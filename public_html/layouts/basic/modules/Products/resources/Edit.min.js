'use strict';

Vtiger_Edit_Js('Products_Edit_Js',{},{baseCurrency:'',baseCurrencyName:'',unitPrice:!1,getUnitPrice:function getUnitPrice(){return !1==this.unitPrice&&(this.unitPrice=$('input.unitPrice',this.getForm())),this.unitPrice},alignBelowUnitPrice:function alignBelowUnitPrice(dataToAlign){var parentElem=$('input[name="unit_price"]',this.getForm());return dataToAlign.position({of:parentElem,my:'left top',at:'left bottom',collision:'flip'}),this},getCurrentElem:function getCurrentElem(e){return $(e.currentTarget)},registerEventForTaxes:function registerEventForTaxes(){var thisInstance=this,formElem=this.getForm();return $('.taxes').on('change',function(e){var elem=thisInstance.getCurrentElem(e),taxBox=elem.data('taxName');elem.is(':checked')?$('input[name='+taxBox+']',formElem).removeAttr('readonly'):$('input[name='+taxBox+']',formElem).attr('readonly','readonly');}),this},registerEnableBaseCurrencyEvent:function registerEnableBaseCurrencyEvent(container){var _this=this,form=this.getForm();container.on('change','.js-base-currency',function(e){var element=$(e.currentTarget),parentElem=element.closest('tr');element.is(':checked')&&(_this.baseCurrencyName=parentElem.data('currencyId'),_this.baseCurrency=$('.js-converted-price',parentElem).val(),form.find('.js-currency').text(parentElem.data('currency-symbol')));});},registerResetCurrencyEvent:function registerResetCurrencyEvent(container){var _this2=this;container.on('click','.js-currency-reset',function(e){var parentElem=$(e.currentTarget).closest('tr'),price=_this2.getUnitPrice().getNumberFromValue()*parentElem.find('.js-conversion-rate').getNumberFromValue();$('.js-converted-price',parentElem).val(App.Fields.Double.formatToDisplay(price));});},calculateConversionRate:function calculateConversionRate(container){var baseCurrencyConvestationRate=container.find('.js-base-currency').filter(':checked').closest('tr').find('.js-conversion-rate');if('1'!=baseCurrencyConvestationRate.val()){console.log('do sprawdzenia',container.find('.js-conversion-rate'));var baseCurrencyRatePrevValue=baseCurrencyConvestationRate.val();container.find('.js-conversion-rate').each(function(key,domElement){var element=$(domElement);console.log(element),element.is(baseCurrencyConvestationRate)||element.val(App.Fields.Double.formatToDisplay(element.getNumberFromValue()/baseCurrencyRatePrevValue));}),baseCurrencyConvestationRate.val('1');}},registerEnableCurrencyEvent:function registerEnableCurrencyEvent(container){var _this3=this;container.on('change','.js-enable-currency',function(e){var element=$(e.currentTarget),parentRow=element.closest('tr');if(element.is(':checked')){element.attr('checked','checked');var price=_this3.getUnitPrice().getNumberFromValue()*parentRow.find('.js-conversion-rate').getNumberFromValue();$('input',parentRow).attr('disabled',!0).removeAttr('disabled'),parentRow.find('.js-currency-reset').attr('disabled',!0).removeAttr('disabled'),parentRow.find('.js-converted-price').val(App.Fields.Double.formatToDisplay(price));}else{if(parentRow.find('.js-base-currency').is(':checked'))return Vtiger_Helper_Js.showPnotify({type:'error',title:'"'+parentRow.find('.js-currency-name').text()+'" '+app.vtranslate('JS_BASE_CURRENCY_CHANGED_TO_DISABLE_CURRENCY')}),void element.prop('checked',!0);parentRow.find('input').attr('disabled','disabled'),parentRow.find('.js-currency-reset').attr('disabled','disabled'),element.removeAttr('disabled checked');}});},registerEventForMoreCurrencies:function registerEventForMoreCurrencies(){var self=this,form=this.getForm();form.find('.js-more-currencies').on('click',function(){var modal=$('<form>').append(form.find('.js-currencies-container .js-currencies-modal').clone());app.showModalWindow({data:modal,css:{"text-align":'left',width:'65%'},cb:function cb(data){var form=data.parent();form.validationEngine(app.validationEngineOptionsForRecord),form.on('submit',function(e){e.preventDefault(),form.validationEngine('validate')&&self.saveCurrencies(form)&&app.hideModalWindow();}),self.baseCurrency=self.getUnitPrice().val(),self.calculateConversionRate(form),self.registerEnableCurrencyEvent(form),self.registerEnableBaseCurrencyEvent(form),self.registerResetCurrencyEvent(form),self.triggerForBaseCurrencyCalc(form);}});});},saveCurrencies:function saveCurrencies(modalContainer){var thisInstance=this,enabledBaseCurrency=modalContainer.find('.js-enable-currency').filter(':checked');if(1>enabledBaseCurrency.length)return Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_PLEASE_SELECT_BASE_CURRENCY_FOR_PRODUCT'),type:'error'}),!1;enabledBaseCurrency.attr('checked','checked'),modalContainer.find('.js-enable-currency').filter(':not(:checked)').removeAttr('checked');var selectedBaseCurrency=modalContainer.find('.js-base-currency').filter(':checked');if(1>selectedBaseCurrency.length)return Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_PLEASE_ENABLE_BASE_CURRENCY_FOR_PRODUCT'),type:'error'}),!1;selectedBaseCurrency.attr('checked','checked'),modalContainer.find('.js-base-currency').filter(':not(:checked)').removeAttr('checked');var parentElem=selectedBaseCurrency.closest('tr');return thisInstance.baseCurrencyName=parentElem.data('currencyId'),thisInstance.baseCurrency=$('.js-converted-price',parentElem).val(),thisInstance.getUnitPrice().val(thisInstance.baseCurrency),$('input[name="base_currency"]',thisInstance.getForm()).val(thisInstance.baseCurrencyName),$('.js-base-currency-check-id',thisInstance.getForm()).attr('name',thisInstance.baseCurrencyName.replace('name','_')+'_check'),thisInstance.getForm().find('.js-currencies-container').html('').append(modalContainer.children().clone()),!0},triggerForBaseCurrencyCalc:function triggerForBaseCurrencyCalc(form){form==null&&(form=this.getForm()),form.find('.js-currencies-modal .js-enable-currency').each(function(index,element){if(element=$(element),element.is(':checked')){var baseCurrencyRow=element.closest('tr');0==parseFloat(baseCurrencyRow.find('.js-converted-price').val())&&baseCurrencyRow.find('.js-currency-reset').trigger('click');}else element.closest('tr').find('.js-converted-price').val('');});},registerEventForUnitPrice:function registerEventForUnitPrice(){var _this4=this;this.getUnitPrice().on('change',function(){_this4.triggerForBaseCurrencyCalc();var baseValue=_this4.getForm().find('.js-base-curencies-value');baseValue.val(_this4.getUnitPrice().val()),baseValue.formatNumber();});},registerEventForUsageunit:function registerEventForUsageunit(){this.checkUsageUnit(),$('select[name="usageunit"]').on('change',this.checkUsageUnit);},checkUsageUnit:function checkUsageUnit(){var selectUsageunit=$('select[name="usageunit"]'),inputQtyPerUnit=$('input[name="qty_per_unit"]'),value=selectUsageunit.val();'pack'===value?inputQtyPerUnit.prop('disabled',!1):inputQtyPerUnit.prop('disabled',!0);},registerEvents:function registerEvents(){this._super(),this.registerEventForMoreCurrencies(),this.registerEventForTaxes(),this.registerEventForUnitPrice(),this.registerEventForUsageunit();}});
//# sourceMappingURL=Edit.min.js.map
