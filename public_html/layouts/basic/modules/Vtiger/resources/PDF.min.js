'use strict';

jQuery.Class('Vtiger_PDF_Js',{validateSubmit:function validateSubmit(container){var templateIds=[],i=0;if(container.find('[name="pdf_template[]"]').each(function(){jQuery(this).is(':checked')&&(templateIds[i]=jQuery(this).val(),i++);}),0<templateIds.length){container.find('#generate_pdf').attr('disabled',!1);var view=app.getUrlVar('view');1<templateIds.length||view&&'List'===view.replace('#','')&&0<JSON.parse(container.find('[name="validRecords"]').val()).length?container.find('#single_pdf').show():container.find('#single_pdf').hide();}else container.find('#generate_pdf').attr('disabled',!0),container.find('#single_pdf').hide();},registerPreSubmitEvent:function registerPreSubmitEvent(container){container.find('#generate_pdf, #single_pdf, #email_pdf').on('click',function(){document.progressLoader=jQuery.progressIndicator({message:app.vtranslate('JS_PDF_GENERATING'),position:'html',blockInfo:{enabled:!0}});var templateIds=[],i=0;container.find('[name="pdf_template[]"]').each(function(){jQuery(this).is(':checked')&&(templateIds[i]=jQuery(this).val(),i++);});var view=app.getUrlVar('view');switch(view&&'List'===view.replace('#','')&&container.find('[name="record"]').val(container.find('[name="validRecords"]').val()),container.find('[name="template"]').val(templateIds),jQuery(this).attr('id')){case'generate_pdf':break;case'single_pdf':container.find('[name="single_pdf"]').val(1),container.find('#pdfExportModal').submit();break;case'email_pdf':container.find('[name="email_pdf"]').val(1),container.find('#pdfExportModal').submit();}document.progressLoader.progressIndicator({mode:'hide'}),app.hideModalWindow();});},registerValidateSubmit:function registerValidateSubmit(container){var thisInstance=this;thisInstance.validateSubmit(container),container.find('[name="pdf_template[]"]').on('change',function(){thisInstance.validateSubmit(container);});},registerListViewCheckRecords:function registerListViewCheckRecords(container){var thisInstance=this;container.find('[name="pdf_template[]"]').on('change',function(){document.progressLoader=jQuery.progressIndicator({message:app.vtranslate('JS_PDF_RECALCULATING'),position:'html',blockInfo:{enabled:!0}});var selectedRecords=container.find('[name="selectedRecords"]').val(),selectedTemplates=[];container.find('[name="pdf_template[]"]:checked').each(function(i){selectedTemplates[i]=jQuery(this).val();});var params={};params.data={module:app.getModuleName(),action:'PDF',mode:'validateRecords',records:selectedRecords,view:app.getViewName(),templates:selectedTemplates},params.dataType='json',AppConnector.request(params).done(function(data){var response=data.result;data.success&&(container.find('[name="validRecords"]').val(JSON.stringify(response.valid_records)),container.find('#recordsInfo').text(response.message),setTimeout(function(){document.progressLoader.progressIndicator({mode:'hide'});},500),thisInstance.validateSubmit(container));}).fail(function(data,err){app.errorLog(data,err);});});},countSelectedRecords:function countSelectedRecords(container){var selectedRecords=JSON.parse(container.find('[name="selectedRecords"]').val());return selectedRecords.length},registerEvents:function registerEvents(){var container=jQuery('div.modal-content');if(this.registerPreSubmitEvent(container),'Detail'===app.getViewName()&&this.registerValidateSubmit(container),'List'===app.getViewName()){this.validateSubmit(container),this.registerListViewCheckRecords(container);var selectedRecords=JSON.parse(container.find('#all_records').val()),recordsInput=container.find('[name="selectedRecords"]'),validInput=container.find('[name="validRecords"]');container.find('div.modal-body').append('<p id="recordsInfo">'+app.vtranslate('JS_RECORD_INFO'),+'</p>'),recordsInput.val(JSON.stringify(selectedRecords)),validInput.val(JSON.stringify(selectedRecords)),jQuery('#recordsInfo').text(selectedRecords.length+' from '+selectedRecords.length+' are valid for chosen template.'),this.validateSubmit(container);}}}),jQuery(function(){var instance=new Vtiger_PDF_Js;instance.registerEvents();});
//# sourceMappingURL=PDF.min.js.map
