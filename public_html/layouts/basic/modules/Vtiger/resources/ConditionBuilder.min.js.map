{"version":3,"file":"ConditionBuilder.min.js","sources":["ConditionBuilder.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nclass Vtiger_ConditionBuilder_Js {\n\n\t/**\n\t * Constructor\n\t * @param {jQuery} container\n\t */\n\tconstructor(container, sourceModuleName) {\n\t\tthis.container = container;\n\t\tthis.sourceModuleName = sourceModuleName;\n\t}\n\n\n\t/**\n\t * Register events when change conditions\n\t * @param {jQuery} container\n\t */\n\tregisterChangeConditions(container) {\n\t\tlet self = this;\n\t\tcontainer.find('.js-conditions-fields, .js-conditions-operator').on('change', function (e) {\n\t\t\tlet progress = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet currentTarget = $(e.currentTarget)\n\t\t\tlet requestParams = {};\n\t\t\tif (currentTarget.hasClass('js-conditions-fields')) {\n\t\t\t\trequestParams = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'ConditionBuilder',\n\t\t\t\t\tsourceModuleName: self.sourceModuleName,\n\t\t\t\t\tfieldname: currentTarget.val()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trequestParams = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'ConditionBuilder',\n\t\t\t\t\tsourceModuleName: self.sourceModuleName,\n\t\t\t\t\tfieldname: container.find('.js-conditions-fields').val(),\n\t\t\t\t\toperator: currentTarget.val(),\n\t\t\t\t};\n\t\t\t}\n\t\t\tAppConnector.request(requestParams).done(function (data) {\n\t\t\t\tprogress.progressIndicator({mode: 'hide'});\n\t\t\t\tcontainer.html($(data).html());\n\t\t\t\tself.registerChangeConditions(container);\n\t\t\t\tself.registerField(container);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * register field types related events\n\t * @param {jQuery} container\n\t */\n\tregisterField(container) {\n\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('select.select2'));\n\t\tApp.Fields.Date.register(container, true, {}, 'js-date-field');\n\t\tApp.Fields.Date.registerRange(container.find('.js-date-range-field'), {ranges: false});\n\t\tapp.registerEventForClockPicker($(container.find('.clockPicker')));\n\t}\n\n\t/**\n\t * Register events to add condition\n\t */\n\tregisterAddCondition() {\n\t\tlet self = this;\n\t\tthis.container.on('click', '.js-condition-add', function (e) {\n\t\t\tlet progress = $.progressIndicator({\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet container = $(this).closest('.js-condition-builder-group-container').find('> .js-condition-builder-conditions-container');\n\t\t\tAppConnector.request({\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: 'ConditionBuilder',\n\t\t\t\tsourceModuleName: self.sourceModuleName,\n\t\t\t}).done(function (data) {\n\t\t\t\tprogress.progressIndicator({mode: 'hide'});\n\t\t\t\tdata = $(data);\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(data.find('select.select2'));\n\t\t\t\tself.registerChangeConditions(data);\n\t\t\t\tcontainer.append(data);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Register events to add group\n\t */\n\tregisterAddGroup() {\n\t\tvar self = this;\n\t\tthis.container.on('click', '.js-group-add', function (e) {\n\t\t\tlet template = self.container.find('.js-condition-builder-group-template').clone();\n\t\t\ttemplate.removeClass('hide');\n\t\t\t$(this).closest('.js-condition-builder-group-container').find('> .js-condition-builder-conditions-container').append(template.html());\n\t\t});\n\t}\n\n\t/**\n\t * Register events to remove group\n\t */\n\tregisterDeleteGroup() {\n\t\tthis.container.on('click', '.js-group-delete', function (e) {\n\t\t\t$(this).closest('.js-condition-builder-group-container').remove();\n\t\t});\n\t};\n\n\t/**\n\t * Register events to remove condition\n\t */\n\tregisterDeleteCondition() {\n\t\tthis.container.on('click', '.js-condition-delete', function (e) {\n\t\t\t$(this).closest('.js-condition-builder-conditions-row').remove();\n\t\t});\n\t};\n\n\t/**\n\t * Block submit on press enter key\n\t */\n\tregisterDisableSubmitOnEnter() {\n\t\tthis.container.find('.js-condition-builder-value').keydown(function (e) {\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Read conditions in group\n\t * @param {jQuery} container\n\t * @returns {object}\n\t */\n\treadCondition(container) {\n\t\tlet self = this;\n\t\tlet condition = container.find('> .js-condition-switch .js-condition-switch-value').hasClass('active') ? 'AND' : 'OR';\n\t\tlet arr = {};\n\t\tarr['condition'] = condition;\n\t\tlet rules = [];\n\t\tcontainer.find('> .js-condition-builder-conditions-container >').each(function () {\n\t\t\tlet\telement = $(this)\n\t\t\tif (element.hasClass('js-condition-builder-conditions-row')) {\n\t\t\t\trules.push({\n\t\t\t\t\t'fieldname': element.find('.js-conditions-fields').val(),\n\t\t\t\t\t'operator': element.find('.js-conditions-operator').val(),\n\t\t\t\t\t'value': element.find('.js-condition-builder-value').val(),\n\t\t\t\t});\n\t\t\t} else if (element.hasClass('js-condition-builder-group-container')) {\n\t\t\t\trules.push(self.readCondition(element));\n\t\t\t}\n\t\t})\n\t\tarr['rules'] = rules;\n\t\treturn arr;\n\t}\n\n\t/**\n\t * Returns conditions\n\t */\n\tgetConditions() {\n\t\treturn this.readCondition(this.container.find('> .js-condition-builder-group-container'));\n\t}\n\n\t/**\n\t * Main function to regsiter events\n\t */\n\tregisterEvents() {\n\t\tlet self = this;\n\t\tthis.registerAddCondition();\n\t\tthis.registerAddGroup();\n\t\tthis.registerDeleteGroup();\n\t\tthis.registerDeleteCondition();\n\t\tthis.registerDisableSubmitOnEnter();\n\t\tthis.container.find('.js-condition-builder-conditions-row').each(function () {\n\t\t\tself.registerChangeConditions($(this));\n\t\t\tself.registerField($(this));\n\t\t})\n\t}\n};\n"],"names":["container","sourceModuleName","find","on","e","$","progressIndicator","position","blockInfo","enabled","currentTarget","requestParams","hasClass","module","app","getModuleName","view","self","fieldname","val","operator","AppConnector","request","done","data","progress","mode","html","registerChangeConditions","registerField","App","Fields","Picklist","showSelect2ElementView","Date","register","registerRange","ranges","registerEventForClockPicker","closest","append","clone","template","removeClass","remove","keydown","keyCode","preventDefault","condition","arr","each","element","rules","push","readCondition","registerAddCondition","registerAddGroup","registerDeleteGroup","registerDeleteCondition","registerDisableSubmitOnEnter"],"mappings":"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"}