{"version":3,"file":"Chat.min.js","sources":["Chat.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n * Class Chat_Js.\n * @type {Window.Chat_Js}\n */\nwindow.Chat_JS = class Chat_Js {\n\t/**\n\t * Constructor\n\t * @param {jQuery} container\n\t */\n\tconstructor(container) {\n\t\tthis.init(container);\n\t\tthis.sendByEnter = app.getCookie(\"chat-notSendByEnter\") !== 'true';\n\t\tthis.isSearchMode = false;\n\t\tthis.isHistoryMode = false;\n\t\tthis.isUnreadMode = false;\n\t\tthis.searchValue = null;\n\t\tthis.isSearchParticipantsMode = false;\n\t\tthis.timerMessage = null;\n\t\tthis.timerRoom = null;\n\t\tthis.amountOfNewMessages = null;\n\t\tthis.isSoundNotification = app.getCookie(\"chat-isSoundNotification\") === 'true';\n\t\tthis.isModalWindow = false;\n\t}\n\n\t/**\n\t * Get instance of Chat_Js.\n\t * @returns {Chat_Js|Window.Chat_Js}\n\t */\n\tstatic getInstance(container, typeInstance = 'modal') {\n\t\tif (typeof Chat_Js.instance === 'undefined') {\n\t\t\tChat_Js.instance = {};\n\t\t}\n\t\tif (typeof Chat_Js.instance[typeInstance] === 'undefined') {\n\t\t\tChat_Js.instance[typeInstance] = new Chat_Js(container);\n\t\t} else {\n\t\t\tChat_Js.instance[typeInstance].init(container);\n\t\t}\n\t\treturn Chat_Js.instance[typeInstance];\n\t}\n\n\t/**\n\t * Get chat header button.\n\t * @returns {jQuery}\n\t */\n\tstatic getHeaderChatButton() {\n\t\tif (typeof Chat_Js.headerChatButton === 'undefined') {\n\t\t\tif (window.location !== window.top.location) {\n\t\t\t\tChat_Js.headerChatButton = window.top.$('.js-header-chat-button');\n\t\t\t} else {\n\t\t\t\tChat_Js.headerChatButton = $('.js-header-chat-button');\n\t\t\t}\n\t\t}\n\t\treturn Chat_Js.headerChatButton;\n\t}\n\n\t/**\n\t * Return the time value for the global timer.\n\t * @returns {int}\n\t */\n\tstatic getRefreshTimeGlobal() {\n\t\tif (typeof Chat_Js.refreshTimerGlobal === 'undefined') {\n\t\t\tChat_Js.refreshTimeGlobal = Chat_Js.getHeaderChatButton().data('refreshTimeGlobal');\n\t\t}\n\t\treturn Chat_Js.refreshTimeGlobal;\n\t}\n\n\t/**\n\t * Register tracking events.\n\t */\n\tstatic registerTrackingEvents() {\n\t\tconst headerChatButton = Chat_Js.getHeaderChatButton();\n\t\tconst showNumberOfNewMessages = headerChatButton.data('showNumberOfNewMessages');\n\t\tconst lblChatNewMessage = headerChatButton.data('lblChatNewMessage');\n\t\tconst lblChat = headerChatButton.data('lblChat');\n\t\tif (headerChatButton.data('userSwitched')) {\n\t\t\theaderChatButton.on('click', (e) => {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: headerChatButton.data('lblChatUserSwitched'),\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tanimation: 'show'\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (!Chat_Js.getRefreshTimeGlobal()) {\n\t\t\treturn;\n\t\t}\n\t\tChat_Js.timerGlobal = setTimeout(() => {\n\t\t\tAppConnector.request({\n\t\t\t\tmodule: 'Chat',\n\t\t\t\taction: 'Room',\n\t\t\t\tmode: 'tracking'\n\t\t\t}).done(function (data) {\n\t\t\t\tconst badge = headerChatButton.find('.js-badge');\n\t\t\t\tif (data.result > 0) {\n\t\t\t\t\theaderChatButton.toggleClass('btn-light').toggleClass('btn-danger');\n\t\t\t\t\tif (showNumberOfNewMessages) {\n\t\t\t\t\t\tbadge.removeClass('hide');\n\t\t\t\t\t\tbadge.html(data.result);\n\t\t\t\t\t}\n\t\t\t\t} else if (headerChatButton.hasClass('btn-danger')) {\n\t\t\t\t\theaderChatButton.removeClass('btn-danger').addClass('btn-light');\n\t\t\t\t\tif (showNumberOfNewMessages) {\n\t\t\t\t\t\tbadge.addClass('hide');\n\t\t\t\t\t\tbadge.html('');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (data.result > Chat_Js.amountOfNewMessages) {\n\t\t\t\t\tif (app.getCookie(\"chat-isSoundNotification\") === 'true') {\n\t\t\t\t\t\tapp.playSound('CHAT');\n\t\t\t\t\t}\n\t\t\t\t\tif (Chat_Js.desktopPermission()) {\n\t\t\t\t\t\tlet message = lblChatNewMessage;\n\t\t\t\t\t\tif (showNumberOfNewMessages) {\n\t\t\t\t\t\t\tmessage += ' ' + data.result;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\t\ttitle: lblChat,\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tChat_Js.amountOfNewMessages = data.result;\n\t\t\t\tChat_Js.registerTrackingEvents();\n\t\t\t});\n\t\t}, Chat_Js.getRefreshTimeGlobal());\n\t}\n\n\t/**\n\t * Unregister tracking events.\n\t */\n\tstatic unregisterTrackingEvents() {\n\t\tclearTimeout(Chat_Js.timerGlobal);\n\t\tconst headerChatButton = Chat_Js.getHeaderChatButton();\n\t\tlet badge = headerChatButton.find('.js-badge');\n\t\tbadge.addClass('hide');\n\t\tbadge.html('');\n\t\theaderChatButton.removeClass('btn-danger').addClass('btn-light');\n\t}\n\n\t/**\n\t * Check if the user has enabled notifications.\n\t * @returns {boolean}\n\t */\n\tstatic desktopPermission() {\n\t\tif (!Chat_Js.isDesktopNotification()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!Chat_Js.checkDesktopPermission()) {\n\t\t\tapp.setCookie(\"chat-isDesktopNotification\", false, 365);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Check if the user has enabled notifications.\n\t * @returns {boolean}\n\t */\n\tstatic isDesktopNotification() {\n\t\treturn app.getCookie(\"chat-isDesktopNotification\") === 'true';\n\t}\n\n\t/**\n\t * Check desktop permission.\n\t * @returns {boolean}\n\t */\n\tstatic checkDesktopPermission() {\n\t\treturn PNotify.modules.Desktop.checkPermission() === 0;\n\t}\n\n\t/**\n\t * Data initialization from the container.\n\t * @param {jQuery} container\n\t */\n\tinit(container) {\n\t\tthis.container = container;\n\t\tthis.messageContainer = this.container.find('.js-chat_content');\n\t\tthis.maxLengthMessage = this.messageContainer.data('maxLengthMessage');\n\t\tthis.searchInput = this.container.find('.js-search-message');\n\t\tthis.searchCancel = this.container.find('.js-search-cancel');\n\t\tthis.searchParticipantsInput = this.container.find('.js-search-participants');\n\t\tthis.searchParticipantsCancel = this.container.find('.js-search-participants-cancel');\n\t\tthis.participants = this.container.find('.js-participants-list .js-users');\n\t}\n\n\t/**\n\t * Sending HTTP requests to the chat module.\n\t * @param {object} data\n\t * @param {bool} progress\n\t * @param {jQuery} elementTo\n\t * @returns {object}\n\t */\n\trequest(data = {}, progress = true, elementTo = this.messageContainer) {\n\t\tconst aDeferred = $.Deferred();\n\t\tlet progressIndicator = null;\n\t\tif (progress) {\n\t\t\tprogressIndicator = this.progressShow(elementTo);\n\t\t}\n\t\tAppConnector.request($.extend({module: 'Chat'}, data)).done((data) => {\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(() => {\n\t\t\tif (this.isModalWindow) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_UNEXPECTED_ERROR'),\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tanimation: 'show'\n\t\t\t\t});\n\t\t\t\tapp.hideModalWindow();\n\t\t\t\tthis.unregisterEvents();\n\t\t\t\tChat_Js.registerTrackingEvents();\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tif (progress) {\n\t\t\t\tprogressIndicator.progressIndicator({mode: 'hide'});\n\t\t\t}\n\t\t});\n\t\treturn aDeferred.promise();\n\t}\n\n\t/**\n\t * Get last message ID.\n\t * @returns {int}\n\t */\n\tgetLastMessageId() {\n\t\treturn this.messageContainer.find('.js-chat-item:last').data('mid');\n\t}\n\n\t/**\n\t * Get room list.\n\t * @param reload\n\t * @returns {jQuery}\n\t */\n\tgetRoomList(reload = false) {\n\t\tif (typeof this.roomList === 'undefined' || reload) {\n\t\t\tthis.roomList = this.container.find('.js-room-list');\n\t\t}\n\t\treturn this.roomList;\n\t}\n\n\t/**\n\t * Show progress indicator.\n\t * @param {jQuery} elementTo\n\t * @returns {jQuery}\n\t */\n\tprogressShow(elementTo) {\n\t\treturn $.progressIndicator({\n\t\t\tposition: 'html',\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true,\n\t\t\t\telementToBlock: elementTo\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Send chat message.\n\t * @param {jQuery} inputMessage\n\t */\n\tsendMessage(inputMessage) {\n\t\tlet len = inputMessage.html().length;\n\t\tif (0 === len) {\n\t\t\treturn;\n\t\t}\n\t\tif (len < this.maxLengthMessage) {\n\t\t\tclearTimeout(this.timerMessage);\n\t\t\tlet mid = null;\n\t\t\tif (!this.isSearchMode) {\n\t\t\t\tmid = this.messageContainer.find('.js-chat-item:last').data('mid')\n\t\t\t}\n\t\t\tthis.request({\n\t\t\t\tview: 'Entries',\n\t\t\t\tmode: 'send',\n\t\t\t\troomType: this.getCurrentRoomType(),\n\t\t\t\trecordId: this.getCurrentRecordId(),\n\t\t\t\tmessage: inputMessage.html(),\n\t\t\t\tmid: mid\n\t\t\t}).done((html) => {\n\t\t\t\tif (this.isSearchMode) {\n\t\t\t\t\tthis.messageContainer.html(html);\n\t\t\t\t\tthis.turnOffSearchMode();\n\t\t\t\t\tthis.registerLoadMore();\n\t\t\t\t} else {\n\t\t\t\t\tthis.messageContainer.append(html);\n\t\t\t\t}\n\t\t\t\tthis.getMessage(true);\n\t\t\t\tthis.buildParticipantsFromMessage($('<div></div>').html(html));\n\t\t\t\tthis.scrollToBottom(false);\n\t\t\t});\n\t\t\tinputMessage.html('');\n\t\t} else {\n\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\ttext: app.vtranslate('JS_MESSAGE_TOO_LONG'),\n\t\t\t\ttype: 'error',\n\t\t\t\tanimation: 'show'\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get the last chat message.\n\t */\n\tgetAll(reloadParticipants = true) {\n\t\tclearTimeout(this.timerMessage);\n\t\tthis.request({\n\t\t\tview: 'Entries',\n\t\t\tmode: 'get',\n\t\t\troomType: this.getCurrentRoomType(),\n\t\t\trecordId: this.getCurrentRecordId()\n\t\t}, false).done((html) => {\n\t\t\tif (html) {\n\t\t\t\tif (!this.isRoomActive()) {\n\t\t\t\t\tthis.activateRoom();\n\t\t\t\t}\n\t\t\t\tif (reloadParticipants) {\n\t\t\t\t\tthis.buildParticipantsFromInput($('<div></div>').html(html).find('.js-participants-data'), true);\n\t\t\t\t}\n\t\t\t\tthis.messageContainer.html(html);\n\t\t\t\tthis.scrollToBottom();\n\t\t\t\tthis.registerLoadMore();\n\t\t\t}\n\t\t\tthis.getMessage(true);\n\t\t});\n\t}\n\n\t/**\n\t * Get more messages.\n\t * @param {jQuery} btn\n\t */\n\tgetMore(btn) {\n\t\tclearTimeout(this.timerMessage);\n\t\tthis.request({\n\t\t\tview: 'Entries',\n\t\t\tmode: 'getMore',\n\t\t\tlastId: btn.data('mid'),\n\t\t\troomType: this.getCurrentRoomType(),\n\t\t\trecordId: this.getCurrentRecordId()\n\t\t}, false).done((html) => {\n\t\t\tif (html) {\n\t\t\t\tbtn.before(html);\n\t\t\t\tbtn.remove();\n\t\t\t\tthis.registerLoadMore();\n\t\t\t}\n\t\t\tthis.getMessage(true);\n\t\t});\n\t}\n\n\t/**\n\t * Search messages.\n\t * @param {jQuery} btn\n\t */\n\tsearchMessage(btn = null) {\n\t\tthis.isHistoryMode = false;\n\t\tclearTimeout(this.timerMessage);\n\t\tlet mid = null;\n\t\tif (btn !== null) {\n\t\t\tmid = btn.data('mid');\n\t\t}\n\t\tthis.request({\n\t\t\tview: 'Entries',\n\t\t\tmode: 'search',\n\t\t\tsearchVal: this.searchInput.val(),\n\t\t\tmid: mid,\n\t\t\troomType: this.getCurrentRoomType(),\n\t\t\trecordId: this.getCurrentRecordId()\n\t\t}, false).done((html) => {\n\t\t\tif (btn === null) {\n\t\t\t\tthis.messageContainer.html(html);\n\t\t\t} else {\n\t\t\t\tbtn.before(html);\n\t\t\t\tbtn.remove();\n\t\t\t}\n\t\t\tthis.registerLoadMore();\n\t\t\tif (mid == null) {\n\t\t\t\tthis.scrollToBottom();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Get history.\n\t * @param {jQuery} btn\n\t * @param {string} groupHistory\n\t */\n\thistory(btn = null, groupHistory = 'crm') {\n\t\tthis.isSearchMode = false;\n\t\tthis.isHistoryMode = true;\n\t\tthis.isUnreadMode = false;\n\t\tclearTimeout(this.timerMessage);\n\t\tlet mid = null;\n\t\tif (btn !== null) {\n\t\t\tmid = btn.data('mid');\n\t\t}\n\t\tthis.turnOffInputAndBtn();\n\t\tthis.request({\n\t\t\tview: 'Entries',\n\t\t\tmode: 'history',\n\t\t\tmid: mid,\n\t\t\tgroupHistory: groupHistory\n\t\t}, true).done((html) => {\n\t\t\tif (btn === null) {\n\t\t\t\tthis.messageContainer.html(html);\n\t\t\t} else {\n\t\t\t\tbtn.before(html);\n\t\t\t\tbtn.remove();\n\t\t\t}\n\t\t\tthis.registerLoadMore();\n\t\t});\n\t}\n\n\t/**\n\t * Turn off unread mode.\n\t */\n\tturnOffUnreadMode() {\n\t\tthis.turnOnInputAndBtnInRoom();\n\t\tthis.isUnreadMode = false;\n\t}\n\n\t/**\n\t * Get unread messages.\n\t */\n\tunread() {\n\t\tclearTimeout(this.timerMessage);\n\t\tthis.isSearchMode = false;\n\t\tthis.isHistoryMode = false;\n\t\tthis.isUnreadMode = true;\n\t\tthis.turnOffInputAndBtn();\n\t\tthis.request({\n\t\t\tview: 'Entries',\n\t\t\tmode: 'unread'\n\t\t}, true).done((html) => {\n\t\t\tthis.messageContainer.html(html);\n\t\t\tthis.participants.html('');\n\t\t\tthis.buildParticipantsFromMessage($('<div></div>').html(html));\n\t\t});\n\t}\n\n\t/**\n\t * Turn off input and button.\n\t */\n\tturnOffInputAndBtn() {\n\t\tlet container = this.container;\n\t\tcontainer.find('.js-users').addClass('hide');\n\t\tcontainer.find('.js-scrollbar').addClass('o-chat__scrollbar--history');\n\t\tcontainer.find('.js-footer-history-hide').removeClass('hide');\n\t\tcontainer.find('.js-footer-history').addClass('hide');\n\t\tcontainer.find('.js-room').removeClass('active o-chat__room');\n\t\tthis.messageContainer.removeClass('col-9');\n\t\tthis.messageContainer.addClass('col-12');\n\t\tcontainer.find('.js-chat-message').addClass('hide');\n\t\tcontainer.find('.js-btn-send').addClass('hide');\n\t\tcontainer.find('.js-input-group-search').addClass('hide');\n\t\tlet footer = container.find('.js-chat-footer');\n\t\tif (this.isHistoryMode) {\n\t\t\tthis.container.find('.js-chat-nav-history').removeClass('hide');\n\t\t\tthis.container.find('.js-footer-history-hide .js-breadcrumb-item').text(footer.data('lblHistory'));\n\t\t} else if (this.isUnreadMode) {\n\t\t\tthis.container.find('.js-chat-nav-history').addClass('hide');\n\t\t\tthis.container.find('.js-footer-history-hide .js-breadcrumb-item').text(footer.data('lblUnread'));\n\t\t}\n\t}\n\n\t/**\n\t * Select nav history.\n\t */\n\tselectNavHistory() {\n\t\tthis.container.find('.js-chat-nav-history .js-chat-link').each((index, element) => {\n\t\t\t$(element).on('click', () => {\n\t\t\t\tthis.history(null, $(element).data('groupName'));\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Turn on after click in room.\n\t */\n\tturnOnInputAndBtnInRoom() {\n\t\tthis.container.on('click', '.js-room', () => {\n\t\t\tlet container = this.container;\n\t\t\tcontainer.find('.js-input-group-search').removeClass('hide');\n\t\t\tcontainer.find('.js-users').removeClass('hide');\n\t\t\tcontainer.find('.js-scrollbar').removeClass('o-chat__scrollbar--history');\n\t\t\tlet messageContainer = container.find('.js-message-container');\n\t\t\tcontainer.find('.js-footer-history-hide').addClass('hide');\n\t\t\tcontainer.find('.js-footer-history').removeClass('hide');\n\t\t\tmessageContainer.removeClass('col-12');\n\t\t\tmessageContainer.addClass('col-9');\n\t\t\tcontainer.find('.js-chat-nav-history').addClass('hide');\n\t\t\tcontainer.find('.js-chat-message').removeClass('hide');\n\t\t\tcontainer.find('.js-btn-send').removeClass('hide');\n\t\t})\n\t}\n\n\t/**\n\t * Turn off search mode.\n\t */\n\tturnOffSearchMode() {\n\t\tthis.searchCancel.addClass('hide');\n\t\tthis.searchInput.val('');\n\t\tthis.isSearchMode = false;\n\t}\n\n\t/**\n\t * Turn off search participants mode.\n\t */\n\tturnOffSearchParticipantsMode() {\n\t\tthis.searchParticipantsCancel.addClass('hide');\n\t\tthis.searchParticipantsInput.val('');\n\t\tthis.isSearchParticipantsMode = false;\n\t\tthis.participants.find('.js-item-user').each((index, element) => {\n\t\t\t$(element).removeClass('hide');\n\t\t});\n\t}\n\n\t/**\n\t * Search participants.\n\t */\n\tsearchParticipants() {\n\t\tlet searchVal = this.searchParticipantsInput.val().toLowerCase();\n\t\tthis.participants.find('.js-item-user').each((index, element) => {\n\t\t\tlet userName = $(element).find('.js-user-name').text().toLowerCase();\n\t\t\t$(element).toggleClass('hide', !(userName.indexOf(searchVal) >= 0));\n\t\t});\n\t\tthis.container.find('.js-participants-list').scrollTop(0);\n\t}\n\n\t/**\n\t * Create a user element.\n\t * @param {object}\n\t * @returns {jQuery}\n\t */\n\tcreateParticipantItem(data = {}) {\n\t\tlet itemUser = this.container.find('.js-participants-list .js-temp-item-user').clone(false, false);\n\t\titemUser.removeClass('js-temp-item-user');\n\t\titemUser.removeClass('hide');\n\t\titemUser.find('.js-user-name').html(data.userName);\n\t\titemUser.find('.js-role').html(data.role);\n\t\titemUser.find('.js-message').html(data.message);\n\t\titemUser.data('userId', data.userId);\n\t\tif (data.image) {\n\t\t\titemUser.find('.js-image .js-chat-image_icon').addClass('hide');\n\t\t\titemUser.find('.js-image .js-chat-image_src').removeClass('hide').attr('src', data.image);\n\t\t}\n\t\treturn itemUser;\n\t}\n\n\t/**\n\t * Return the participants' ID list from the message.\n\t * @returns {int[]}\n\t */\n\tgetParticipantsFromMessages(messageContainer) {\n\t\tlet participantsId = [];\n\t\tmessageContainer.find('.js-chat-item').each((index, element) => {\n\t\t\tlet userId = $(element).data('userId');\n\t\t\tif ($.inArray(userId, participantsId) < 0) {\n\t\t\t\tparticipantsId.push(userId);\n\t\t\t}\n\t\t});\n\t\treturn participantsId;\n\t}\n\n\t/**\n\t * Create new participants.\n\t * @param {int[]} participantsId\n\t */\n\tcreateParticipants(participantsId = []) {\n\t\tif (!participantsId.length) {\n\t\t\treturn;\n\t\t}\n\t\tlet len = participantsId.length;\n\t\tfor (let i = 0; i < len; ++i) {\n\t\t\tlet userId = participantsId[i];\n\t\t\tlet lastMessage = this.messageContainer.find('.js-chat-item[data-user-id=' + userId + ']:last');\n\t\t\tif (lastMessage.length) {\n\t\t\t\tthis.participants.append(\n\t\t\t\t\tthis.createParticipantItem({\n\t\t\t\t\t\tuserName: lastMessage.find('.js-author').data('userName'),\n\t\t\t\t\t\trole: lastMessage.find('.js-author').data('roleName'),\n\t\t\t\t\t\tmessage: lastMessage.find('.messages').html(),\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\timage: lastMessage.find('.js-author .js-image .js-chat-image_src').attr('src')\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Build a list of participants from the message.\n\t */\n\tbuildParticipantsFromMessage(messageContainer) {\n\t\tif (this.isSearchParticipantsMode) {\n\t\t\treturn;\n\t\t}\n\t\tlet currentParticipants = [];\n\t\tthis.participants.find('.js-item-user').each((index, element) => {\n\t\t\tlet userId = $(element).data('userId');\n\t\t\tcurrentParticipants.push(userId);\n\t\t\tlet lastMessage = messageContainer.find('.js-chat-item[data-user-id=' + userId + ']:last');\n\t\t\tif (lastMessage.length) {\n\t\t\t\t$(element).find('.js-message').html(lastMessage.find('.js-message').html());\n\t\t\t}\n\t\t});\n\t\tthis.createParticipants(\n\t\t\t$(this.getParticipantsFromMessages(messageContainer)).not(currentParticipants).get()\n\t\t);\n\t}\n\n\t/**\n\t * Build a list of participants\n\t * @param {jQuery} element\n\t * @param {bool} add\n\t */\n\tbuildParticipantsFromInput(element, reload = false) {\n\t\tif (this.isSearchParticipantsMode) {\n\t\t\treturn;\n\t\t}\n\t\tif (reload) {\n\t\t\tthis.participants.html('');\n\t\t}\n\t\tif (element.length) {\n\t\t\tlet users = JSON.parse(element.val());\n\t\t\tlet len = users.length;\n\t\t\tfor (let i = 0; i < len; ++i) {\n\t\t\t\tthis.participants.append(\n\t\t\t\t\tthis.createParticipantItem({\n\t\t\t\t\t\tuserName: users[i]['user_name'],\n\t\t\t\t\t\trole: users[i]['role_name'],\n\t\t\t\t\t\tmessage: users[i]['message'],\n\t\t\t\t\t\tuserId: users[i]['user_id'],\n\t\t\t\t\t\timage: users[i]['image'],\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Is chat room active.\n\t * @returns {boolean}\n\t */\n\tisRoomActive() {\n\t\treturn this.container.find('.js-container-chat').length === 0 || !this.container.find('.js-container-chat').hasClass('hide');\n\t}\n\n\t/**\n\t * Get current room type.\n\t * @returns {string}\n\t */\n\tgetCurrentRoomType() {\n\t\treturn this.messageContainer.data('currentRoomType');\n\t}\n\n\t/**\n\t * Get current record ID.\n\t * @returns {int}\n\t */\n\tgetCurrentRecordId() {\n\t\treturn this.messageContainer.data('currentRecordId');\n\t}\n\n\t/**\n\t * Is this a view for the record.\n\t * @returns {boolean}\n\t */\n\tisViewForRecord() {\n\t\treturn this.messageContainer.data('viewForRecord');\n\t}\n\n\t/**\n\t * Get message timer.\n\t * @returns {int}\n\t */\n\tgetMessageTimer() {\n\t\treturn this.messageContainer.data('messageTimer');\n\t}\n\n\t/**\n\t * Get room timer.\n\t * @returns {int}\n\t */\n\tgetRoomTimer() {\n\t\treturn this.messageContainer.data('roomTimer');\n\t}\n\n\t/**\n\t * Activate chat room.\n\t */\n\tactivateRoom() {\n\t\tthis.container.find('.js-container-button').addClass('hide');\n\t\tthis.container.find('.js-container-chat').removeClass('hide');\n\t}\n\n\t/**\n\t * Scroll the chat content down.\n\t */\n\tscrollToBottom(scrollToTop = true) {\n\t\tconst chatContent = this.messageContainer.closest('.js-chat-main-content');\n\t\tif (scrollToTop) {\n\t\t\tchatContent.scrollTop(0);\n\t\t}\n\t\tif (chatContent.length) {\n\t\t\tchatContent.animate({\n\t\t\t\tscrollTop: chatContent[0].scrollHeight\n\t\t\t}, 300);\n\t\t}\n\t}\n\n\t/**\n\t * Play sound notification.\n\t */\n\tsoundNotification() {\n\t\tif (this.isSoundNotification) {\n\t\t\tapp.playSound('CHAT');\n\t\t}\n\t}\n\n\t/**\n\t * Select room.\n\t * @param {string} roomType\n\t * @param {int} recordId\n\t */\n\tselectRoom(roomType, recordId) {\n\t\tconst roomList = this.getRoomList();\n\t\troomList.find('.js-room').each((index, element) => {\n\t\t\t$(element).removeClass('active o-chat__room');\n\t\t});\n\t\tlet itemRoom = roomList.find('.js-room-type[data-room-type=' + roomType + '] .js-room[data-record-id=' + recordId + ']');\n\t\titemRoom.addClass('active o-chat__room');\n\t\tthis.getRoomName(itemRoom, roomType);\n\t\titemRoom.find('.js-room-cnt').html('');\n\t\tthis.messageContainer.data('currentRoomType', roomType);\n\t\tthis.messageContainer.data('currentRecordId', recordId);\n\t}\n\n\t/**\n\t * Create a room element.\n\t * @param {object}\n\t * @returns {jQuery}\n\t */\n\tcreateRoomItem(data = {}, favorite = false, roomType = 'global') {\n\t\tlet itemRoom = this.container.find('.js-room-list .js-temp-item-room').clone(false, false);\n\t\titemRoom.removeClass('js-temp-item-room').removeClass('hide');\n\t\titemRoom.addClass('d-flex');\n\t\titemRoom.find('.js-room-name').html(data.name);\n\t\titemRoom.attr('title', data.name);\n\t\tif (roomType === 'crm') {\n\t\t\titemRoom.find('.js-link')\n\t\t\t\t.removeClass('hide')\n\t\t\t\t.attr('href', \"index.php?module=\" + data['moduleName'] + \"&view=Detail&record=\" + data.recordid);\n\t\t}\n\t\tif (data['cnt_new_message'] == 0) {\n\t\t\titemRoom.find('.js-room-cnt').html('');\n\t\t} else {\n\t\t\titemRoom.find('.js-room-cnt').html(data['cnt_new_message']);\n\t\t}\n\t\tif (favorite) {\n\t\t\titemRoom.find('.js-remove-favorites').removeClass('hide');\n\t\t}\n\t\titemRoom.attr('data-record-id', data.recordid);\n\t\treturn itemRoom;\n\t}\n\n\t/**\n\t * Get room name.\n\t * @param {object}\n\t * @param {string} roomType\n\t */\n\tgetRoomName(data, roomType) {\n\t\tlet container = this.container;\n\t\tlet containerFooter = container.find('.js-chat-footer');\n\t\tcontainer.find('.js-group-name').each(function (e) {\n\t\t\tlet element = $(this);\n\t\t\tif (element.data('group') == roomType) {\n\t\t\t\tcontainerFooter.find('.js-footer-group-name').text(element.text());\n\t\t\t}\n\t\t});\n\t\tcontainerFooter.find('.js-footer-room-name').text(data.find('.js-room-name').text());\n\t}\n\n\t/**\n\t * Refresh all information about the rooms\n\t * @param {object} data\n\t */\n\treloadRoomsDetail(data) {\n\t\tconst currentRoomType = this.getCurrentRoomType();\n\t\tconst currentRecordId = this.getCurrentRecordId();\n\t\tconst roomList = this.getRoomList();\n\t\tlet cnt = 0;\n\t\tthis.selectRoom(data.currentRoom.roomType, data.currentRoom.recordId);\n\t\tfor (let key in data.roomList) {\n\t\t\tlet roomTypeList = roomList.find('.js-room-type[data-room-type=\"' + key + '\"]').not(\".js-hide-group\");\n\t\t\troomTypeList.html('');\n\t\t\tfor (let idx in data.roomList[key]) {\n\t\t\t\tlet newMessage = data.roomList[key][idx]['cnt_new_message'];\n\t\t\t\tif (newMessage !== null) {\n\t\t\t\t\tcnt += newMessage;\n\t\t\t\t}\n\t\t\t\tlet itemRoom = this.createRoomItem(data.roomList[key][idx], roomTypeList.data('favoriteRemoveBtn'), key);\n\t\t\t\tif (key === currentRoomType && data.roomList[key][idx]['recordid'] === currentRecordId) {\n\t\t\t\t\titemRoom.addClass('active o-chat__room');\n\t\t\t\t}\n\t\t\t\troomTypeList.append(itemRoom);\n\t\t\t}\n\t\t}\n\t\tif (this.amountOfNewMessages !== null && cnt > this.amountOfNewMessages) {\n\t\t\tthis.soundNotification();\n\t\t}\n\t\tthis.amountOfNewMessages = cnt;\n\t\tthis.registerSwitchRoom();\n\t\tthis.registerButtonFavoritesInModal();\n\t}\n\n\t/**\n\t * Get new message\n\t * @param {bool} timer\n\t */\n\tgetMessage(timer = false) {\n\t\tif (timer) {\n\t\t\tclearTimeout(this.timerMessage);\n\t\t}\n\t\tthis.timerMessage = setTimeout(() => {\n\t\t\tthis.request({\n\t\t\t\tview: 'Entries',\n\t\t\t\tmode: 'get',\n\t\t\t\tlastId: this.getLastMessageId(),\n\t\t\t\troomType: this.getCurrentRoomType(),\n\t\t\t\trecordId: this.getCurrentRecordId(),\n\t\t\t\tviewForRecord: this.isViewForRecord()\n\t\t\t}, false).done((html) => {\n\t\t\t\tif (html) {\n\t\t\t\t\tif (!this.isRoomActive()) {\n\t\t\t\t\t\tthis.activateRoom();\n\t\t\t\t\t}\n\t\t\t\t\tthis.messageContainer.append(html);\n\t\t\t\t\tthis.buildParticipantsFromMessage($('<div></div>').html(html));\n\t\t\t\t\tthis.scrollToBottom(false);\n\t\t\t\t}\n\t\t\t\tif (timer) {\n\t\t\t\t\tthis.getMessage(true);\n\t\t\t\t}\n\t\t\t});\n\t\t}, this.getMessageTimer());\n\t}\n\n\t/**\n\t * Get rooms details\n\t * @param {bool} timer\n\t */\n\tgetRoomsDetail(timer = false) {\n\t\tif (timer) {\n\t\t\tclearTimeout(this.timerRoom);\n\t\t}\n\t\tthis.timerRoom = setTimeout(() => {\n\t\t\tthis.request({\n\t\t\t\taction: 'Room',\n\t\t\t\tmode: 'getAll'\n\t\t\t}, false).done((data) => {\n\t\t\t\tthis.reloadRoomsDetail(data['result']);\n\t\t\t\tif (timer) {\n\t\t\t\t\tthis.getRoomsDetail(true);\n\t\t\t\t}\n\t\t\t});\n\t\t}, this.getRoomTimer());\n\t}\n\n\t/**\n\t * Register send event\n\t */\n\tregisterSendEvent() {\n\t\tconst inputMessage = this.container.find('.js-chat-message');\n\t\tinputMessage.on('keydown', (e) => {\n\t\t\tif (!this.sendByEnter) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!e.shiftKey && e.keyCode === 13) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.sendMessage(inputMessage);\n\t\t\t}\n\t\t});\n\t\tthis.container.find('.js-btn-send').on('click', () => {\n\t\t\tthis.sendMessage(inputMessage);\n\t\t});\n\t}\n\n\t/**\n\t * Register switch room\n\t */\n\tregisterSwitchRoom() {\n\t\tthis.container.find('.js-room-list .js-room').off('click').on('click', (e) => {\n\t\t\tclearTimeout(this.timerMessage);\n\t\t\tclearTimeout(this.timerRoom);\n\t\t\tlet element = $(e.currentTarget);\n\t\t\tlet recordId = element.data('recordId');\n\t\t\tlet roomType = element.closest('.js-room-type').data('roomType');\n\t\t\tthis.request({\n\t\t\t\tview: 'Entries',\n\t\t\t\tmode: 'get',\n\t\t\t\troomType: roomType,\n\t\t\t\trecordId: recordId\n\t\t\t}, true, this.container).done((html) => {\n\t\t\t\tthis.turnOffSearchParticipantsMode();\n\t\t\t\tthis.selectRoom(roomType, recordId);\n\t\t\t\tthis.buildParticipantsFromInput($('<div></div>').html(html).find('.js-participants-data'), true);\n\t\t\t\tthis.messageContainer.html(html);\n\t\t\t\tthis.getMessage(true);\n\t\t\t\tthis.getRoomsDetail(true);\n\t\t\t\tthis.scrollToBottom();\n\t\t\t\tthis.registerLoadMore();\n\t\t\t\tthis.turnOffSearchMode();\n\t\t\t\tthis.isHistoryMode = false;\n\t\t\t\tthis.turnOffUnreadMode();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Button favorites.\n\t */\n\tregisterButtonFavorites() {\n\t\tlet btnRemove = this.container.find('.js-remove-from-favorites');\n\t\tlet btnAdd = this.container.find('.js-add-from-favorites');\n\t\tbtnRemove.off('click').on('click', (e) => {\n\t\t\tbtnRemove.toggleClass('hide');\n\t\t\tbtnAdd.toggleClass('hide');\n\t\t\tthis.request({\n\t\t\t\taction: 'Room',\n\t\t\t\tmode: 'removeFromFavorites',\n\t\t\t\troomType: this.getCurrentRoomType(),\n\t\t\t\trecordId: this.getCurrentRecordId()\n\t\t\t});\n\t\t});\n\t\tbtnAdd.off('click').on('click', (e) => {\n\t\t\tbtnRemove.toggleClass('hide');\n\t\t\tbtnAdd.toggleClass('hide');\n\t\t\tthis.request({\n\t\t\t\taction: 'Room',\n\t\t\t\tmode: 'addToFavorites',\n\t\t\t\troomType: this.getCurrentRoomType(),\n\t\t\t\trecordId: this.getCurrentRecordId()\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Register buttons favorites in modal.\n\t */\n\tregisterButtonFavoritesInModal() {\n\t\tthis.getRoomList().find('.js-room .js-remove-favorites').off('click').on('click', (e) => {\n\t\t\tclearTimeout(this.timerMessage);\n\t\t\te.stopPropagation();\n\t\t\tlet btn = $(e.currentTarget);\n\t\t\tlet item = btn.closest('.js-room');\n\t\t\tlet roomType = btn.closest('.js-room-type').data('roomType');\n\t\t\tthis.request({\n\t\t\t\taction: 'Room',\n\t\t\t\tmode: 'removeFromFavorites',\n\t\t\t\troomType: roomType,\n\t\t\t\trecordId: item.data('recordId')\n\t\t\t}).done(() => {\n\t\t\t\tif (roomType === 'group') {\n\t\t\t\t\tlet listGroup = this.getRoomList().find('.js-hide-group');\n\t\t\t\t\titem.detach();\n\t\t\t\t\titem.find('.js-remove-favorites').addClass('hide');\n\t\t\t\t\titem.find('.js-add-favorites').removeClass('hide');\n\t\t\t\t\tlistGroup.append(item);\n\t\t\t\t\tthis.container.find('.js-btn-more-remove').removeClass('hide');\n\t\t\t\t\tthis.container.find('.js-btn-more').addClass('hide');\n\t\t\t\t\tlistGroup.removeClass('hide');\n\t\t\t\t} else {\n\t\t\t\t\titem.remove();\n\t\t\t\t}\n\t\t\t\tthis.getRoomsDetail(true);\n\t\t\t});\n\t\t});\n\t\tthis.getRoomList().find('.js-room .js-add-favorites').off('click').on('click', (e) => {\n\t\t\te.stopPropagation();\n\t\t\tlet btn = $(e.currentTarget);\n\t\t\tlet item = btn.closest('.js-room');\n\t\t\tlet roomType = btn.closest('.js-room-type').data('roomType');\n\t\t\tthis.request({\n\t\t\t\taction: 'Room',\n\t\t\t\tmode: 'addToFavorites',\n\t\t\t\troomType: roomType,\n\t\t\t\trecordId: item.data('recordId')\n\t\t\t}).done(() => {\n\t\t\t\tif (roomType === 'group') {\n\t\t\t\t\tlet listGroup = this.getRoomList().find('.js-room-type[data-room-type=group]').not('.js-hide-group');\n\t\t\t\t\titem.detach();\n\t\t\t\t\titem.find('.js-remove-favorites').removeClass('hide');\n\t\t\t\t\titem.find('.js-add-favorites').addClass('hide');\n\t\t\t\t\tlistGroup.append(item);\n\t\t\t\t\tif (this.getRoomList().find('.js-hide-group .js-room').length === 0) {\n\t\t\t\t\t\tthis.container.find('.js-btn-more-remove').addClass('hide');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\titem.remove();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Button more in room.\n\t */\n\tregisterButtonMoreInRoom() {\n\t\tlet btnMore = this.container.find('.js-btn-more');\n\t\tlet btnMoreRemove = this.container.find('.js-btn-more-remove');\n\t\tlet listHideGroup = this.container.find('.js-hide-group');\n\t\tbtnMore.on('click', (e) => {\n\t\t\tlistHideGroup.toggleClass('hide');\n\t\t\tbtnMore.toggleClass('hide');\n\t\t\tbtnMoreRemove.toggleClass('hide');\n\t\t});\n\t\tbtnMoreRemove.on('click', (e) => {\n\t\t\tlistHideGroup.toggleClass('hide');\n\t\t\tbtnMore.toggleClass('hide');\n\t\t\tbtnMoreRemove.toggleClass('hide');\n\t\t});\n\t}\n\n\t/**\n\t * Register load more messages.\n\t */\n\tregisterLoadMore() {\n\t\tthis.messageContainer.find('.js-load-more').off('click').on('click', (e) => {\n\t\t\tlet btn = $(e.currentTarget);\n\t\t\tif (this.isSearchMode) {\n\t\t\t\tthis.searchMessage(btn);\n\t\t\t} else if (this.isHistoryMode) {\n\t\t\t\tthis.history(\n\t\t\t\t\tbtn,\n\t\t\t\t\tthis.container.find('.js-chat-nav-history .js-chat-link .active').closest('.js-chat-link').data('groupName')\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.getMore(btn);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Register search message events.\n\t */\n\tregisterSearchMessage() {\n\t\tthis.searchInput.off('keydown').on('keydown', (e) => {\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (this.searchInput.val() === '') {\n\t\t\t\t\tthis.searchCancel.addClass('hide');\n\t\t\t\t\tthis.isSearchMode = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.isSearchMode = true;\n\t\t\t\t\tthis.searchCancel.removeClass('hide');\n\t\t\t\t\tthis.searchMessage();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.container.find('.js-icon-search-message').on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\tif (this.searchInput.val() === '') {\n\t\t\t\tthis.searchCancel.addClass('hide');\n\t\t\t\tthis.isSearchMode = false;\n\t\t\t} else {\n\t\t\t\tthis.isSearchMode = true;\n\t\t\t\tthis.searchCancel.removeClass('hide');\n\t\t\t\tthis.searchMessage();\n\t\t\t}\n\t\t});\n\t\tthis.searchCancel.off('click').on('click', (e) => {\n\t\t\te.preventDefault();\n\t\t\tthis.turnOffSearchMode();\n\t\t\tthis.getAll(false);\n\t\t});\n\t}\n\n\t/**\n\t * Register search participants.\n\t */\n\tregisterSearchParticipants() {\n\t\tthis.searchParticipantsInput.off('keyup').on('keyup', (e) => {\n\t\t\tlet len = this.searchParticipantsInput.val().length;\n\t\t\tif (1 < len) {\n\t\t\t\tthis.isSearchParticipantsMode = true;\n\t\t\t\tthis.searchParticipantsCancel.removeClass('hide');\n\t\t\t} else if (len === 0) {\n\t\t\t\tthis.turnOffSearchParticipantsMode();\n\t\t\t}\n\t\t\tthis.searchParticipants();\n\t\t});\n\t\tthis.searchParticipantsCancel.off('click').on('click', (e) => {\n\t\t\tthis.turnOffSearchParticipantsMode();\n\t\t\tthis.searchParticipants();\n\t\t});\n\t}\n\n\t/**\n\t * Register button history.\n\t */\n\tregisterButtonHistory() {\n\t\tthis.container.find('.js-btn-history').off('click').on('click', (e) => {\n\t\t\tthis.history();\n\t\t});\n\t}\n\n\t/**\n\t * Register button settings.\n\t */\n\tregisterButtonSettings() {\n\t\tthis.container.find('.js-btn-settings').off('click').on('click', (e) => {\n\n\t\t});\n\t}\n\n\t/**\n\t * Register button desktop notification.\n\t */\n\tregisterButtonDesktopNotification() {\n\t\tlet btnDesktop = this.container.find('.js-btn-desktop-notification');\n\t\tlet iconOn = btnDesktop.data('iconOn');\n\t\tlet iconOff = btnDesktop.data('iconOff');\n\t\tif (Chat_Js.isDesktopNotification() && !Chat_Js.checkDesktopPermission()) {\n\t\t\tapp.setCookie(\"chat-isDesktopNotification\", false, 365);\n\t\t\tbtnDesktop.find('.js-icon').removeClass(iconOn).addClass(iconOff);\n\t\t} else if (Chat_Js.isDesktopNotification()) {\n\t\t\tbtnDesktop.find('.js-icon').removeClass(iconOff).addClass(iconOn);\n\t\t}\n\t\tbtnDesktop.off('click').on('click', (e) => {\n\t\t\tbtnDesktop.find('.js-icon').toggleClass(iconOn + \" \" + iconOff);\n\t\t\tif (btnDesktop.find('.js-icon').hasClass(iconOn)) {\n\t\t\t\tif (!Chat_Js.checkDesktopPermission()) {\n\t\t\t\t\tPNotify.modules.Desktop.permission();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (!Chat_Js.checkDesktopPermission()) {\n\t\t\t\t\t\t\tapp.setCookie(\"chat-isDesktopNotification\", false, 365);\n\t\t\t\t\t\t\tbtnDesktop.find('.js-icon').removeClass(iconOn).addClass(iconOff);\n\t\t\t\t\t\t\tthis.desktopNotificationShouldReload = true;\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_NO_DESKTOP_PERMISSION'),\n\t\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\t\tanimation: 'show'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tapp.setCookie(\"chat-isDesktopNotification\", true, 365);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 2000);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tapp.setCookie(\"chat-isDesktopNotification\", false, 365);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Register button bell.\n\t */\n\tregisterButtonBell() {\n\t\tlet btnBell = this.container.find('.js-btn-bell');\n\t\tbtnBell.off('click').on('click', (e) => {\n\t\t\tlet icon = btnBell.find('.js-icon');\n\t\t\ticon.toggleClass(btnBell.data('iconOn')).toggleClass(btnBell.data('iconOff'));\n\t\t\tthis.isSoundNotification = icon.hasClass(btnBell.data('iconOn'));\n\t\t\tapp.setCookie(\"chat-isSoundNotification\", this.isSoundNotification, 365);\n\t\t});\n\t}\n\n\t/**\n\t * Register button unread.\n\t */\n\tregisterButtonUnread() {\n\t\tthis.container.find('.js-btn-unread').on('click', (e) => {\n\t\t\tthis.unread();\n\t\t});\n\t}\n\n\t/**\n\t * Button that enables / disables the sending of messages by pressing the ENTER button.\n\t */\n\tregisterButtonToggleEnter() {\n\t\tlet btnEnter = this.container.find('.js-btn-enter');\n\t\tbtnEnter.on('click', (e) => {\n\t\t\tthis.sendByEnter = !this.sendByEnter;\n\t\t\tapp.setCookie(\"chat-notSendByEnter\", !this.sendByEnter, 365);\n\t\t\tlet icon = btnEnter.find('.js-icon');\n\t\t\ticon.toggleClass(btnEnter.data('iconOn'), this.sendByEnter).toggleClass(btnEnter.data('iconOff'), !this.sendByEnter);\n\t\t});\n\t}\n\n\t/**\n\t * Register close modal.\n\t */\n\tregisterCloseModal() {\n\t\tthis.container.find('.close[data-dismiss=\"modal\"]').on('click', (e) => {\n\t\t\tthis.unregisterEvents();\n\t\t\tChat_Js.registerTrackingEvents();\n\t\t});\n\t}\n\n\t/**\n\t * Register base events\n\t */\n\tregisterBaseEvents() {\n\t\tthis.registerSendEvent();\n\t\tthis.registerLoadMore();\n\t\tthis.getMessage(true);\n\t\tthis.registerButtonFavorites();\n\t\tthis.registerSearchMessage();\n\t\tthis.registerSearchParticipants();\n\t\tnew App.Fields.Text.Completions(this.container.find('.js-completions'));\n\t\tsetTimeout(() => {\n\t\t\tthis.scrollToBottom();\n\t\t}, 100);\n\t}\n\n\t/**\n\t * Register modal events\n\t */\n\tregisterModalEvents() {\n\t\tthis.getRoomList(true);\n\t\tthis.getRoomsDetail(true);\n\t\tthis.registerBaseEvents();\n\t\tthis.registerSwitchRoom();\n\t\tthis.registerButtonHistory();\n\t\tthis.registerButtonSettings();\n\t\tthis.registerButtonBell();\n\t\tthis.registerButtonUnread();\n\t\tthis.registerButtonFavoritesInModal();\n\t\tthis.registerButtonMoreInRoom();\n\t\tthis.registerButtonDesktopNotification();\n\t\tthis.registerButtonToggleEnter();\n\t\tthis.registerCloseModal();\n\t\tthis.turnOnInputAndBtnInRoom();\n\t\tthis.selectNavHistory();\n\t\tChat_Js.unregisterTrackingEvents();\n\t\tthis.isModalWindow = true;\n\t}\n\n\t/**\n\t * Unregister events.\n\t */\n\tunregisterEvents() {\n\t\tclearTimeout(this.timerMessage);\n\t\tclearTimeout(this.timerRoom);\n\t}\n};\n"],"names":["window","Chat_JS","container","init","sendByEnter","getCookie","isSearchMode","isHistoryMode","isUnreadMode","searchValue","isSearchParticipantsMode","timerMessage","timerRoom","amountOfNewMessages","isSoundNotification","isModalWindow","messageContainer","find","maxLengthMessage","data","searchInput","searchCancel","searchParticipantsInput","searchParticipantsCancel","participants","progress","elementTo","aDeferred","$","Deferred","progressIndicator","progressShow","AppConnector","request","extend","module","done","resolve","fail","Vtiger_Helper_Js","showPnotify","text","app","vtranslate","type","animation","hideModalWindow","unregisterEvents","Chat_Js","registerTrackingEvents","always","mode","promise","roomList","reload","position","blockInfo","enabled","elementToBlock","inputMessage","len","html","length","clearTimeout","mid","view","roomType","getCurrentRoomType","recordId","getCurrentRecordId","message","turnOffSearchMode","registerLoadMore","append","getMessage","buildParticipantsFromMessage","scrollToBottom","reloadParticipants","isRoomActive","activateRoom","buildParticipantsFromInput","btn","lastId","before","remove","searchVal","val","groupHistory","turnOffInputAndBtn","turnOnInputAndBtnInRoom","addClass","removeClass","footer","each","index","element","on","history","toLowerCase","toggleClass","indexOf","scrollTop","itemUser","clone","userName","role","userId","image","attr","inArray","participantsId","push","i","lastMessage","createParticipantItem","currentParticipants","createParticipants","getParticipantsFromMessages","not","get","JSON","parse","users","hasClass","chatContent","closest","scrollToTop","animate","scrollHeight","playSound","getRoomList","itemRoom","getRoomName","favorite","name","recordid","containerFooter","currentRecordId","cnt","selectRoom","currentRoom","key","idx","newMessage","createRoomItem","roomTypeList","currentRoomType","soundNotification","registerSwitchRoom","registerButtonFavoritesInModal","timer","setTimeout","getLastMessageId","viewForRecord","isViewForRecord","getMessageTimer","action","reloadRoomsDetail","getRoomsDetail","getRoomTimer","e","shiftKey","keyCode","preventDefault","sendMessage","off","currentTarget","turnOffSearchParticipantsMode","turnOffUnreadMode","btnRemove","btnAdd","stopPropagation","item","detach","listGroup","btnMoreRemove","listHideGroup","btnMore","searchMessage","getMore","getAll","searchParticipants","btnDesktop","iconOn","iconOff","isDesktopNotification","checkDesktopPermission","setCookie","PNotify","modules","Desktop","permission","desktopNotificationShouldReload","btnBell","icon","unread","btnEnter","registerSendEvent","registerButtonFavorites","registerSearchMessage","registerSearchParticipants","Fields","Text","Completions","registerBaseEvents","registerButtonHistory","registerButtonSettings","registerButtonBell","registerButtonUnread","registerButtonMoreInRoom","registerButtonDesktopNotification","registerButtonToggleEnter","registerCloseModal","selectNavHistory","unregisterTrackingEvents","instance","typeInstance","headerChatButton","location","top","refreshTimerGlobal","refreshTimeGlobal","getHeaderChatButton","showNumberOfNewMessages","lblChatNewMessage","lblChat","getRefreshTimeGlobal","timerGlobal","result","badge","desktopPermission","showNotify","title","checkPermission"],"mappings":"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"}