'use strict';

$.Class('Settings_Vtiger_Index_Js',{showMessage:function showMessage(customParams){var params={type:'success',title:app.vtranslate('JS_MESSAGE')};'undefined'!=typeof customParams&&(params=$.extend(params,customParams)),Vtiger_Helper_Js.showPnotify(params);},selectIcon:function selectIcon(){var aDeferred=$.Deferred();return app.showModalWindow({id:'iconsModal',url:'index.php?module=Vtiger&view=IconsModal&parent=Settings',cb:function cb(container){App.Fields.Picklist.showSelect2ElementView(container.find('#iconsList'),{templateSelection:function templateSelection(data){if(!data.id)return data.text;var type=$(data.element).data('type');return container.find('.iconName').text(data.id),container.find('#iconName').val(data.id),container.find('#iconType').val(type),'icon'===type?container.find('.iconExample').html('<span class="'+data.element.value+'" aria-hidden="true"></span>'):'image'===type&&(container.find('.iconName').text(data.text),container.find('#iconName').val(data.element.value),container.find('.iconExample').html('<img width="24px" src="'+data.element.value+'"/>')),data.text},templateResult:function templateResult(data){if(!data.id)return data.text;var option,type=$(data.element).data('type');return 'icon'===type?option=$('<span class="'+data.element.value+'" aria-hidden="true"></span><span> - '+$(data.element).data('class')+'</span>'):'image'===type&&(option=$('<img width="24px" src="'+data.element.value+'" title="'+data.text+'" /><span> - '+data.text+'</span>')),option},closeOnSelect:!0}),container.find('[name="saveButton"]').on('click',function(){aDeferred.resolve({type:container.find('#iconType').val(),name:container.find('#iconName').val()}),app.hideModalWindow(container,'iconsModal');});}}),aDeferred.promise()},showWarnings:function showWarnings(){$('li[data-mode="systemWarnings"] a').click();},showSecurity:function showSecurity(){app.openUrl('index.php?module=Log&parent='+app.getParentModuleName()+'&view=Index&type=access_for_admin');}},{registerDeleteShortCutEvent:function registerDeleteShortCutEvent(shortCutBlock){var thisInstance=this;'undefined'==typeof shortCutBlock&&(shortCutBlock=$('div#settingsShortCutsContainer')),shortCutBlock.on('click','.unpin',function(e){var actionEle=$(e.currentTarget),closestBlock=actionEle.closest('.moduleBlock'),fieldId=actionEle.data('id'),shortcutBlockActionUrl=closestBlock.data('actionurl'),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(shortcutBlockActionUrl+'&pin=false').done(function(data){if('OK'==data.result.SUCCESS){closestBlock.remove(),thisInstance.registerSettingShortCutAlignmentEvent();var shortCutActionEle=$('#'+fieldId+'_menuItem'),imagePath=shortCutActionEle.data('pinimageurl');shortCutActionEle.attr('src',imagePath).data('action','pin'),progressIndicatorElement.progressIndicator({mode:'hide'});var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_SUCCESSFULLY_UNPINNED'),type:'info'};thisInstance.registerReAlign(),Vtiger_Helper_Js.showPnotify(params);}}),e.stopPropagation();});},registerPinShortCutEvent:function registerPinShortCutEvent(element){var id=element.data('id'),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request('index.php?module=Vtiger&parent=Settings&action=Basic&mode=updateFieldPinnedStatus&pin=true&fieldid='+id).done(function(data){if('OK'==data.result.SUCCESS){AppConnector.request({fieldid:id,mode:'getSettingsShortCutBlock',module:'Vtiger',parent:'Settings',view:'IndexAjax'}).done(function(data){var existingDivBlock=$('#settingsShortCutsContainer');$(data).appendTo(existingDivBlock),progressIndicatorElement.progressIndicator({mode:'hide'});var params={text:app.vtranslate('JS_SUCCESSFULLY_PINNED')};Settings_Vtiger_Index_Js.showMessage(params);});}});},registerSettingsShortcutClickEvent:function registerSettingsShortcutClickEvent(){$('#settingsShortCutsContainer').on('click','.moduleBlock',function(e){var url=$(e.currentTarget).data('url');window.location.href=url;});},registerSettingShortCutAlignmentEvent:function registerSettingShortCutAlignmentEvent(){$('#settingsShortCutsContainer').find('.moduleBlock').removeClass('marginLeftZero'),$('#settingsShortCutsContainer').find('.moduleBlock:nth-child(3n+1)').addClass('marginLeftZero');},registerWidgetsEvents:function registerWidgetsEvents(){var widgets=$('div.widgetContainer');widgets.on('shown.bs.collapse',function(e){var widgetContainer=$(e.currentTarget),quickWidgetHeader=widgetContainer.closest('.quickWidget').find('.quickWidgetHeader'),imageEle=quickWidgetHeader.find('.imageElement'),imagePath=imageEle.data('downimage');imageEle.attr('src',imagePath);}),widgets.on('hidden.bs.collapse',function(e){var widgetContainer=$(e.currentTarget),quickWidgetHeader=widgetContainer.closest('.quickWidget').find('.quickWidgetHeader'),imageEle=quickWidgetHeader.find('.imageElement'),imagePath=imageEle.data('rightimage');imageEle.attr('src',imagePath);});},registerAddShortcutDragDropEvent:function registerAddShortcutDragDropEvent(){var thisInstance=this,elements=$('.js-menu__item .js-menu__link--draggable');elements.draggable({containment:'#page',appendTo:'body',helper:'clone',start:function start(e,ui){$(ui.helper).addClass('ui-draggable-menuShortcut bg-warning');},zIndex:99999}),$('#settingsShortCutsContainer').droppable({activeClass:'ui-state-default',hoverClass:'ui-state-hover',accept:'.js-menu__item .js-menu__link--draggable',drop:function drop(event,ui){var url=ui.draggable.attr('href'),isExist=!1;if($('#settingsShortCutsContainer [id^="shortcut"]').each(function(){var shortCutUrl=$(this).data('url');if(shortCutUrl==url)return void(isExist=!0)}),isExist){var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_SHORTCUT_ALREADY_ADDED'),type:'info'};Vtiger_Helper_Js.showPnotify(params);}else thisInstance.registerPinShortCutEvent(ui.draggable.parent()),thisInstance.registerSettingShortCutAlignmentEvent();}});},registerReAlign:function registerReAlign(){AppConnector.request({mode:'realignSettingsShortCutBlock',module:'Vtiger',parent:'Settings',view:'IndexAjax'}).done(function(data){$('#settingsShortCutsContainer').html(data);});},loadEditorElement:function loadEditorElement(){new App.Fields.Text.Editor($('.js-editor'),{});},registerSaveIssues:function registerSaveIssues(){var container=$('.addIssuesModal');container.validationEngine(app.validationEngineOptions);var title=$('#titleIssues'),CKEditorInstance=CKEDITOR.instances.bodyIssues,thisInstance=this,saveBtn=container.find('.saveIssues');saveBtn.on('click',function(){if(container.validationEngine('validate')){var body=CKEditorInstance.document.getBody().getHtml(),params={module:'Github',parent:app.getParentModuleName(),action:'SaveIssuesAjax',title:title.val(),body:body};AppConnector.request(params).done(function(data){if(app.hideModalWindow(),thisInstance.reloadContent(),!0==data.result.success){var params={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_ADDED_ISSUE_COMPLETE'),type:'success'};Vtiger_Helper_Js.showMessage(params);}});}}),$('[name="confirmRegulations"]').on('click',function(){var currentTarget=$(this);currentTarget.is(':checked')?saveBtn.removeAttr('disabled'):saveBtn.attr('disabled','disabled');});},reloadContent:function reloadContent(){$('.js-tabs li .active').trigger('click');},resisterSaveKeys:function resisterSaveKeys(modal){var thisInstance=this,container=modal.find('.authModalContent');container.validationEngine(app.validationEngineOptions),container.find('.saveKeys').on('click',function(){if(container.validationEngine('validate')){var params={module:'Github',parent:app.getParentModuleName(),action:'SaveKeysAjax',username:$('[name="username"]').val(),client_id:$('[name="client_id"]').val(),token:$('[name="token"]').val()};container.progressIndicator({}),AppConnector.request(params).done(function(data){if(container.progressIndicator({mode:'hide'}),!1==data.result.success){var errorDiv=container.find('.errorMsg');errorDiv.removeClass('d-none'),errorDiv.html(app.vtranslate('JS_ERROR_KEY'));}else{app.hideModalWindow(),thisInstance.reloadContent();var params={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_AUTHORIZATION_COMPLETE'),type:'success'};Vtiger_Helper_Js.showMessage(params);}}).fail(function(){container.progressIndicator({mode:'hide'}),app.hideModalWindow();});}});},registerTabEvents:function registerTabEvents(){var thisInstance=this;$('.js-tabs li').on('click',function(){thisInstance.loadContent($(this).data('mode'),!1,$(this).data('params'));});},registerPagination:function registerPagination(){var page=$('.pagination .pageNumber'),thisInstance=this;page.on('click',function(){thisInstance.loadContent('github',$(this).data('id'));});},registerAuthorizedEvent:function registerAuthorizedEvent(){var thisInstance=this;$('.showModal').on('click',function(){app.showModalWindow($('.authModal'),function(container){thisInstance.resisterSaveKeys(container);});});},registerGithubEvents:function registerGithubEvents(container){var thisInstance=this;thisInstance.registerAuthorizedEvent(),thisInstance.registerPagination(),container.find('.js-switch--state, .js-switch--author').on('change',function(){thisInstance.loadContent('github',1);}),$('.addIssuesBtn').on('click',function(){var params={module:'Github',parent:app.getParentModuleName(),view:'AddIssue'};container.progressIndicator({}),AppConnector.request(params).done(function(data){container.progressIndicator({mode:'hide'}),app.showModalWindow(data,function(){thisInstance.loadEditorElement(),thisInstance.registerSaveIssues();});});});},registerWarningsAlert:function registerWarningsAlert(){var alertsContainer=$('#systemWarningAletrs');alertsContainer.length&&app.showModalWindow(alertsContainer,function(){alertsContainer.find('.warning').first().removeClass('d-none'),alertsContainer.find('.warning .btn').on('click',function(){var params,btn=$(this),save=!0;if(btn.hasClass('ajaxBtn')){if(btn.data('params')===void 0){var form=btn.closest('form');form.hasClass('validateForm')&&!form.validationEngine('validate')&&(save=!1),params=btn.closest('form').serializeArray().reduce(function(obj,item){return obj[item.name]=item.value,obj},{});}else params=btn.data('params');save&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'update',id:btn.closest('.warning').data('id'),params:params}).done(function(data){data.result.result?Vtiger_Helper_Js.showMessage({text:data.result.message,type:'success'}):Vtiger_Helper_Js.showMessage({text:data.result.message,type:'error'});});}btn.hasClass('cancel')&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'cancel'}),save&&(alertsContainer.find('.warning').first().remove(),alertsContainer.find('.warning').length?alertsContainer.find('.warning').first().removeClass('d-none'):app.hideModalWindow(alertsContainer));}),alertsContainer.find('.input-group-addon input[type="checkbox"]').on('click',function(){var btn=$(this),group=btn.closest('.input-group');this.checked?group.find('input[type="text"]').attr('disabled',!1):group.find('input[type="text"]').attr('disabled',!0);});});},registerSystemWarningsEvents:function registerSystemWarningsEvents(container){var thisInstance=this;thisInstance.registerWarningsFolders(container);},registerWarningsFolders:function registerWarningsFolders(container){var thisInstance=this,data=[],treeValues=container.find('#treeValues').val();treeValues&&(data=JSON.parse(treeValues)),container.find('#jstreeContainer').jstree({core:{data:data,themes:{name:'proton',responsive:!0,icons:!1},check_callback:!0},plugins:['checkbox']}).on('loaded.jstree',function(){$(this).jstree('open_all');}).on('changed.jstree',function(e,data){'model'!=data.action&&thisInstance.getWarningsList();}),$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate('JS_S_LENGTH_MENU'),sZeroRecords:app.vtranslate('JS_NO_RESULTS_FOUND'),sInfo:app.vtranslate('JS_S_INFO'),sInfoEmpty:app.vtranslate('JS_S_INFO_EMPTY'),sSearch:app.vtranslate('JS_SEARCH'),sEmptyTable:app.vtranslate('JS_NO_RESULTS_FOUND'),sInfoFiltered:app.vtranslate('JS_S_INFO_FILTERED'),sLoadingRecords:app.vtranslate('JS_LOADING_OF_RECORDS'),sProcessing:app.vtranslate('JS_LOADING_OF_RECORDS'),oPaginate:{sFirst:app.vtranslate('JS_S_FIRST'),sPrevious:app.vtranslate('JS_S_PREVIOUS'),sNext:app.vtranslate('JS_S_NEXT'),sLast:app.vtranslate('JS_S_LAST')},oAria:{sSortAscending:app.vtranslate('JS_S_SORT_ASCENDING'),sSortDescending:app.vtranslate('JS_S_SORT_DESCENDING')}}}),container.find('.js-switch--warnings').on('change',function(){thisInstance.getWarningsList();});},getWarningsList:function getWarningsList(){var thisInstance=this,selected=thisInstance.getSelectedFolders(),container=$('#warningsContent'),progressIndicator=$.progressIndicator({message:app.vtranslate('JS_LOADING_OF_RECORDS'),blockInfo:{enabled:!0}}),active=$('.warningsIndexPage .js-switch--warnings').first().is(':checked');AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),view:'Index',mode:'getWarningsList',active:active,folder:selected}).done(function(data){container.html(data),thisInstance.registerWarningsList(container),progressIndicator.progressIndicator({mode:'hide'});}).fail(function(){progressIndicator.progressIndicator({mode:'hide'});});},registerWarningsList:function registerWarningsList(container){var thisInstance=this;container.find('table').dataTable({order:[[2,'desc']]}),container.find('.showDescription').on('click',function(){var html=$(this).closest('td').find('.showDescriptionContent').html();app.showModalWindow(html);}),container.find('.setIgnore').on('click',function(){container.find('.js-popover-tooltip').popover('hide');var data=$(this).closest('tr').data();AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'update',id:data.id,params:data.status}).done(function(){thisInstance.getWarningsList(container);});});},getSelectedFolders:function getSelectedFolders(){var selected=[];return $.each($('#jstreeContainer').jstree('get_selected',!0),function(index,value){selected.push(value.original.subPath);}),selected},loadContent:function loadContent(mode,page,modeParams){var thisInstance=this,container=$('.indexContainer'),state=container.find('.js-switch--state'),author=container.find('.js-switch--author'),params={mode:mode,module:app.getModuleName(),parent:app.getParentModuleName(),view:'Index'};page&&(params.page=page),modeParams&&(params.params=modeParams),params.state=state.last().is(':checked')?'closed':'open',params.author=author.first().is(':checked');var progressIndicatorElement=$.progressIndicator({position:'html',blockInfo:{enabled:!0,elementToBlock:container}});AppConnector.request(params).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),container.html(data),'index'==mode?(thisInstance.registerSettingsShortcutClickEvent(),thisInstance.registerDeleteShortCutEvent(),thisInstance.registerWidgetsEvents(),thisInstance.registerAddShortcutDragDropEvent(),thisInstance.registerSettingShortCutAlignmentEvent(),thisInstance.registerWarningsAlert()):'github'==mode?thisInstance.registerGithubEvents(container):'systemWarnings'==mode&&thisInstance.registerSystemWarningsEvents(container);});},registerEvents:function registerEvents(){this.registerTabEvents(),this.reloadContent();}});
//# sourceMappingURL=Index.min.js.map
