{"version":3,"file":"ApiAddress.min.js","sources":["ApiAddress.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Settings_ApiAddress_Configuration_Js\", {}, {\n\tregisterChangeApi: function (content) {\n\t\tcontent.find('#change_api').on('change', function () {\n\t\t\tvar value = $(this).val();\n\t\t\tcontent.find('.api_row').addClass('d-none');\n\t\t\tif (value) {\n\t\t\t\tcontent.find('.' + value).removeClass('d-none');\n\t\t\t}\n\t\t});\n\t},\n\tregisterSave: function (content) {\n\t\tconst thisInstance = this;\n\t\tcontent.find('.saveGlobal').on('click', function () {\n\t\t\tAppConnector.request({\n\t\t\t\tdata: {\n\t\t\t\t\tmodule: 'ApiAddress',\n\t\t\t\t\tparent: 'Settings',\n\t\t\t\t\taction: 'SaveConfig',\n\t\t\t\t\telements: {\n\t\t\t\t\t\tmin_length: $('[name=\"min_length\"]').val(),\n\t\t\t\t\t\tresult_num: $('[name=\"result_num\"]').val(),\n\t\t\t\t\t\tapi_name: 'global',\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tdataType: 'json'\n\t\t\t}).done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttext: data['result']['message'],\n\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t});\n\t\t\t\t}).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tcontent.find('.save').on('click', function () {\n\t\t\tvar elements = {};\n\t\t\tjQuery(this).closest('.apiContainer').find('.api').each(function () {\n\t\t\t\tvar name = jQuery(this).attr('name');\n\n\t\t\t\tif (jQuery(this).attr('type') == 'checkbox') {\n\t\t\t\t\telements[name] = jQuery(this).prop('checked') ? 1 : 0;\n\t\t\t\t} else {\n\t\t\t\t\telements[name] = jQuery(this).val();\n\t\t\t\t}\n\t\t\t});\n\t\t\telements['api_name'] = jQuery(this).closest('.apiContainer').find('.apiAdrress').data('api-name');\n\t\t\t// validate fields\n\t\t\tif (!thisInstance.registerValidate(elements)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\telements = jQuery.extend({}, elements);\n\t\t\tlet params = {}\n\t\t\tparams.data = {module: 'ApiAddress', parent: 'Settings', action: 'SaveConfig', 'elements': elements}\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tlet response = data['result'];\n\t\t\t\tif (response['success']) {\n\t\t\t\t\tif (elements['key']) {\n\t\t\t\t\t\tthisInstance.registerReload();\n\t\t\t\t\t}\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\tregisterRemoveConnection: function (content) {\n\t\tconst thisInstance = this;\n\t\tcontent.find('.delete').on('click', function () {\n\t\t\tAppConnector.request({\n\t\t\t\tdata: {\n\t\t\t\t\tmodule: 'ApiAddress',\n\t\t\t\t\tparent: 'Settings',\n\t\t\t\t\taction: 'SaveConfig',\n\t\t\t\t\telements: {\n\t\t\t\t\t\tkey: '0',\n\t\t\t\t\t\tnominatim: '0',\n\t\t\t\t\t\tapi_name: jQuery(this).closest('.apiContainer').find('.apiAdrress').data('api-name')\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tdataType: 'json'\n\t\t\t}).done(function (data) {\n\t\t\t\tlet response = data['result'];\n\t\t\t\tif (response['success']) {\n\t\t\t\t\tthisInstance.registerReload();\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\tregisterReload: function () {\n\t\tvar thisInstance = this;\n\t\tvar progress = jQuery.progressIndicator({\n\t\t\t'message': app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\t'position': '.contentsDiv',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tjQuery.get(\"index.php?module=ApiAddress&parent=Settings&view=Configuration\", function (data) {\n\t\t\tjQuery('.contentsDiv').html(data);\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(jQuery('.contentsDiv').find('select.select2'));\n\t\t\tprogress.progressIndicator({'mode': 'hide'});\n\t\t\tthisInstance.registerEvents();\n\t\t});\n\t},\n\tregisterValidate: function (elements) {\n\t\tvar thisInstance = this;\n\t\tvar status = true;\n\t\tfor (var i in elements) {\n\t\t\tif (i == 'min_length' || i == 'result_num') {\n\t\t\t\tif (!thisInstance.registerValidatemin_length(elements[i])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i == 'key') {\n\t\t\t\tif (!thisInstance.registerValidatekey(elements.key, elements.api_name)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn status;\n\n\t},\n\tregisterValidatemin_length: function (val) {\n\t\tvar filter = /^\\d+$/;\n\n\t\tif (!filter.test(val) || (1 == val || 0 == val)) {\n\t\t\tvar par = {\n\t\t\t\ttext: app.vtranslate('JS_WRONG_NUMBER'),\n\t\t\t\ttype: 'error'\n\t\t\t};\n\t\t\tVtiger_Helper_Js.showPnotify(par);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\tregisterValidatekey: function (val, apiName) {\n\t\tvar status = true;\n\n\t\tif ('opencage_data' == apiName) {\n\t\t\tvar test = \"https://api.opencagedata.com/geocode/v1/json?query=test&pretty=1&key=\" + val;\n\t\t\tjQuery.ajax({\n\t\t\t\turl: test,\n\t\t\t\tasync: false,\n\t\t\t\tcomplete: function (data) {\n\t\t\t\t\tif (data.status == 403) {\n\t\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\t\ttext: app.vtranslate('Invalid API key'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t\t\tstatus = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn status;\n\t},\n\tregisterEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar content = $('.contentsDiv');\n\n\t\tthisInstance.registerChangeApi(content);\n\t\tthisInstance.registerSave(content);\n\t\tthisInstance.registerRemoveConnection(content);\n\t}\n});\n"],"names":["jQuery","Class","registerChangeApi","content","find","on","$","val","addClass","value","removeClass","registerSave","AppConnector","request","data","module","parent","action","elements","min_length","result_num","api_name","async","dataType","done","Vtiger_Helper_Js","showPnotify","text","type","fail","app","vtranslate","closest","each","attr","name","prop","thisInstance","registerValidate","extend","params","response","registerReload","registerRemoveConnection","key","nominatim","progress","progressIndicator","get","html","App","Fields","Picklist","showSelect2ElementView","registerEvents","registerValidatemin_length","filter","test","par","registerValidatekey","apiName","ajax","url","complete","status","parametry"],"mappings":"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"}