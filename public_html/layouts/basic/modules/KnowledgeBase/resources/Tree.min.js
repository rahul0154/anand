'use strict';

jQuery.Class('KnowledgeBase_Tree_Js',{},{treeInstance:!1,content:!1,getContent:function getContent(){return this.content||(this.content=$('.contentOfData')),this.content},generateTree:function generateTree(container,data){var thisInstance=this;thisInstance.treeInstance=container.find('#treeContent');var values=data.result;thisInstance.treeInstance.jstree({core:{data:values,themes:{name:'proton',responsive:!0}},plugins:['search']});},loadTree:function loadTree(reload){var thisInstance=this,container=$('.treeContainer'),params={module:app.getModuleName(),action:'DataTreeAjax'},progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});reload&&thisInstance.treeInstance.jstree('destroy'),AppConnector.request(params).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),thisInstance.generateTree(container,data),thisInstance.registerTreeEvents(container);});},searchingInTree:function searchingInTree(text){this.treeInstance.jstree(!0).search(text);},registerSearchEvent:function registerSearchEvent(){var thisInstance=this,valueSearch=$('#valueSearchTree'),btnSearch=$('#btnSearchTree');valueSearch.on('keypress',function(e){13==e.which&&thisInstance.searchingInTree(valueSearch.val());}),btnSearch.on('click',function(){thisInstance.searchingInTree(valueSearch.val());});},loadContent:function loadContent(recordId){var thisInstance=this,contentData=thisInstance.getContent(),params={module:app.getModuleName(),view:'Content'};'undefined'!=typeof recordId&&(params.record=recordId);var progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(params).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),contentData.html(data),'undefined'==typeof recordId&&($.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate('JS_S_LENGTH_MENU'),sZeroRecords:app.vtranslate('JS_NO_RESULTS_FOUND'),sInfo:app.vtranslate('JS_S_INFO'),sInfoEmpty:app.vtranslate('JS_S_INFO_EMPTY'),sSearch:app.vtranslate('JS_SEARCH'),sEmptyTable:app.vtranslate('JS_NO_RESULTS_FOUND'),sInfoFiltered:app.vtranslate('JS_S_INFO_FILTERED'),sLoadingRecords:app.vtranslate('JS_LOADING_OF_RECORDS'),sProcessing:app.vtranslate('JS_LOADING_OF_RECORDS'),oPaginate:{sFirst:app.vtranslate('JS_S_FIRST'),sPrevious:app.vtranslate('JS_S_PREVIOUS'),sNext:app.vtranslate('JS_S_NEXT'),sLast:app.vtranslate('JS_S_LAST')},oAria:{sSortAscending:app.vtranslate('JS_S_SORT_ASCENDING'),sSortDescending:app.vtranslate('JS_S_SORT_DESCENDING')}}}),contentData.find('.dataTableWithDocuments').dataTable());});},registerTreeEvents:function registerTreeEvents(){var thisInstance=this;thisInstance.registerSearchEvent(),thisInstance.treeInstance.on('changed.jstree',function(e,data){'folder'!=data.node.original.type&&thisInstance.loadContent(data.node.original.record_id);});},registerBasicEvents:function registerBasicEvents(){var thisInstance=this;$('.addRecord').on('click',function(){var headerInstance=Vtiger_Header_Js.getInstance(),moduleName=app.getModuleName();headerInstance.quickCreateModule(moduleName,{callbackFunction:function postQuickCreate(){thisInstance.loadTree(!0),thisInstance.loadContent();},noCache:!1});});},registerEvents:function registerEvents(){var thisInstance=this;thisInstance.registerBasicEvents(),thisInstance.loadTree(!1),thisInstance.loadContent();}});
//# sourceMappingURL=Tree.min.js.map
